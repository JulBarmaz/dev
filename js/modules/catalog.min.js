var orderDeliveryNeedRecalc=0;function getDeliveryForm(e){setOrderUserDataForm()}function setOrderUserDataForm(){ajaxShowActivity(),$("#calculate_delivery_button").hide(),$("#submit_order_button").hide(),$("#delivery_form").hide(),$("#info_container").html(""),pt_id=("hidden"==$("#payment_selector input").prop("type")?$("#payment_selector input[name=payment_type]"):$("#payment_selector input[name=payment_type]:checked")).val(),dt_id=("hidden"==$("#delivery_selector input").prop("type")?$("#delivery_selector input[name=delivery_type]"):$("#delivery_selector input[name=delivery_type]:checked")).val(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",task:"renderUserDataForm",pt_id:pt_id,dt_id:dt_id},dataType:"json",success:function(e,t){$("#delivery_form").html(e.html),$("#delivery_form").show(),calculateDelivery(1),afterAjaxUpdate("delivery_form"),ajaxHideActivity()},error:function(){return ajaxHideActivity(),!1}})}function setDeliveryList(){ajaxShowActivity(),pt_id=("hidden"==$("#payment_selector input").prop("type")?$("#payment_selector input[name=payment_type]"):$("#payment_selector input[name=payment_type]:checked")).val(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",task:"renderDeliverySelector",psid:pt_id},dataType:"html",success:function(e,t){$("#delivery_selector").html(e),$("#delivery_form").html(""),ajaxHideActivity(),setOrderUserDataForm()},error:function(){return ajaxHideActivity(),!1}})}function fillAddressPanel(e){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",task:"getAddress",psid:$(e).val()},dataType:"json",success:function(a,e){var t,i=["country_id","region_id","district_id","locality_id"],o="region_id",r="district_id",s="locality_id";for(t in a)if("use_as_default"!==t&&null!=$("#"+t).prop("type"))switch($("#"+t).prop("type")){case"checkbox":"1"==a[t]?$("#"+t).attr("checked","checked"):$("#"+t).attr("checked",""),$("#"+t).change();break;case"select-one":-1==i.indexOf(t)?($("#"+t).val(a[t]),$("#"+t).change()):"country_id"===t&&($("#"+t).val(a[t]),ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"user",view:"panel",task:"getRegionSelector",ctrl_pref:"",psid:a.country_id},dataType:"html",success:function(e,t){ajaxShowActivity(),is_required=$("#"+o).hasClass("required"),elem=$("#"+o).parent(),$("#"+o).remove(),elem.append(e),is_required&&!$("#"+o).hasClass("required")&&$("#"+o).addClass("required"),$("#"+o).val(a[o]),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"user",view:"panel",task:"getDistrictSelector",ctrl_pref:"",psid:a[o]},dataType:"html",success:function(e,t){is_required=$("#"+r).hasClass("required"),elem=$("#"+r).parent(),$("#"+r).remove(),elem.append(e),is_required&&!$("#"+r).hasClass("required")&&$("#"+r).addClass("required"),$("#"+r).val(a[r]),ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"user",view:"panel",task:"getLocalitySelector",ctrl_pref:"",psid:a[r]},dataType:"html",success:function(e,t){is_required=$("#"+s).hasClass("required"),elem=$("#"+s).parent(),$("#"+s).remove(),elem.append(e),is_required&&!$("#"+s).hasClass("required")&&$("#"+s).addClass("required"),$("#"+s).val(a[s]),$("#"+s).change(),ajaxHideActivity()},error:function(){return alert("Error occured"),ajaxHideActivity(),!1}})},error:function(){return alert("Error occured"),ajaxHideActivity(),!1}})},error:function(){return alert("Error occured"),ajaxHideActivity(),!1}}));break;default:$("#"+t).val(a[t])}ajaxHideActivity()},error:function(){return ajaxHideActivity(),!1}})}function toggleAddressPanel(e,t){0<$(e).val()?$("#"+t).hide():$("#"+t).show()}function checkDeliveryForm(e,t){return!!form_checkfill("dt_selector",e)&&(t&&fillManualInput("dt_selector"),!0)}function setCustomGoodsFilter(e,t,a){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",task:"setCustomFilter",filter_by:e,psid:t},dataType:"html",success:function(e,t){if(ajaxHideActivity(),"OK"==e)return window.location.href=a,!0},error:function(){return ajaxHideActivity(),!1}})}function resetCustomGoodsFilter(e){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",task:"resetCustomFilter",filter_by:e},dataType:"html",success:function(e,t){"OK"==e&&window.location.reload()},error:function(){return ajaxHideActivity(),!1}})}function goodsComplectSetVisible(e,t){5==$(e).val()?$("#gmtab_"+t).show():$("#gmtab_"+t).hide()}function setMaskPriceSetting(){var e="{";return(e+='"parent_group":"'+$("#parent_group").val()+'",')+('"enabled_only":"'+$("#enabled_only").prop("checked").toString()+'",')+('"break_by_groups":"'+$("#break_by_groups").prop("checked").toString()+'",')+('"show_pack_price":"'+$("#show_pack_price").prop("checked").toString()+'",')+('"show_weight_price":"'+$("#show_weight_price").prop("checked").toString()+'",')+('"show_volume_price":"'+$("#show_volume_price").prop("checked").toString()+'",')+('"show_company_info":"'+$("#show_company_info").prop("checked").toString()+'",')+('"show_thumbs":"'+$("#show_thumbs").prop("checked").toString()+'",')+('"show_dimensions":"'+$("#show_dimensions").prop("checked").toString()+'",')+('"show_weight":"'+$("#show_weight").prop("checked").toString()+'"')+"}"}function savePriceSettings(){$.ajax({url:siteConfig.siteUrl+"index.php",type:"POST",data:{type:"module",option:"ajax",module:"catalog",task:"savePriceSettings",p_id:$("#p_id").val(),p_new:$("#p_new").prop("checked"),p_name:$("#p_name").val(),p_checkbox:setMaskPriceSetting(),p_discont:$("#price_discount").val(),p_price:$("#price_type").val(),p_comment:$("#priceset_comment").val(),p_head_colon:$("#p_head_colon").val(),p_foot_colon:$("#p_foot_colon").val(),p_comment:$("#p_comment").val(),p_template:$("#p_template").val()},dataType:"html",success:function(e,t){alert(e)},error:function(){return ajaxHideActivity(),!1}})}function getPriceSettings(e){$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",task:"getPriceSettings",p_id:$("#"+e).val()},dataType:"json",success:function(e,t){if(null!=e.p_checkbox){var a=JSON.parse(e.p_checkbox);for(keyck in a)"true"==a[keyck]?($("#"+keyck).attr("checked","checked"),$("label[for='"+keyck+"']:first").addClass("CheckboxChecked")):"false"==a[keyck]?($("#"+keyck).removeAttr("checked"),$("label[for='"+keyck+"']:first").removeClass("CheckboxChecked")):$("#"+keyck).val(a[keyck])}for(key in e)"p_checkbox"!=key&&$("#"+key).val(e[key])},error:function(){return ajaxHideActivity(),!1}})}function calculateDelivery(a){ajaxShowActivity(),$("#info_container").html(""),$("#submit_order_button").hide(),$("#calculate_delivery_button").show();var i=$("form#dt_selector").serializeArray();$.each(i,function(e,t){"view"==t.name&&(i[e].value=""),"layout"==t.name&&(i[e].value="")}),i[i.length]={name:"module",value:"catalog"},i[i.length]={name:"option",value:"ajax"},i[i.length]={name:"task",value:"calculateDelivery"},i[i.length]={name:"on_load",value:a},i[i.length]={name:"order_results_weight",value:$("#order_results_weight").val()},i[i.length]={name:"order_results_summa",value:$("#order_results_summa").val()},i[i.length]={name:"order_results_summa_text",value:$("#order_results_summa_text").val()},i[i.length]={name:"order_results_total",value:$("#order_results_total").val()},i[i.length]={name:"order_results_total_text",value:$("#order_results_total_text").val()},i[i.length]={name:"order_results_currency",value:$("#order_results_currency").val()},$.ajax({url:siteConfig.siteUrl+"index.php",data:i,dataType:"json",success:function(e,t){0===e.is_error?(orderDeliveryNeedRecalc=e.need_recalc,0<e.delivery_sum&&$("#info_container").append(e.delivery_text),0<e.taxes_sum&&$("#info_container").append(e.taxes_text),0<e.total_sum&&$("#info_container").append(e.total_text),1!=a||0==e.need_recalc?($("#submit_order_button").show(),$("#calculate_delivery_button").hide()):($("#submit_order_button").hide(),$("#calculate_delivery_button").show())):($("#info_container").html(e.error_text),$("#submit_order_button").hide(),$("#calculate_delivery_button").show()),ajaxHideActivity()},error:function(){return ajaxHideActivity(),!1}})}function orderUserdataChanged(e){1==orderDeliveryNeedRecalc&&($("#submit_order_button").hide(),$("#calculate_delivery_button").show(),$("#info_container").html(""))}function orderOnSubmit(){checkDeliveryForm(!0,!0)&&$("form#dt_selector").submit()}function addToFavourites(t,e){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",psid:e,task:"addToFavourites",view:"goods"},success:function(e){$(t).parent(".favouritesButtons").removeClass("notInFavourites").addClass("inFavourites"),ajaxHideActivity()},error:function(){ajaxHideActivity()}})}function removeFromFavourites(t,e,a,i){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",psid:e,task:"removeFromFavourites",view:"goods"},success:function(e){$(t).parent(".favouritesButtons").removeClass("inFavourites").addClass("notInFavourites"),null!=a&&($(a).remove(),null!=i&&1===i&&location.reload()),applyAfterContentLoadHandlers(".catalog_list"),ajaxHideActivity()},error:function(){ajaxHideActivity()}})}function addToCompare(t,e){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",psid:e,task:"addToCompare",view:"goods"},success:function(e){$(t).parent(".compareButtons").removeClass("notInCompare").addClass("inCompare"),ajaxHideActivity()},error:function(){ajaxHideActivity()}})}function removeFromCompare(t,e,a,i){ajaxShowActivity(),$.ajax({url:siteConfig.siteUrl+"index.php",data:{type:"module",option:"ajax",module:"catalog",psid:e,task:"removeFromCompare",view:"goods"},success:function(e){$(t).parent(".compareButtons").removeClass("inCompare").addClass("notInCompare"),null!=a&&($(a).remove(),null!=i&&1===i&&location.reload()),ajaxHideActivity()},error:function(){ajaxHideActivity()}})}function toggleGoodsListMode(e){$(".catalog_list .goods-list").hasClass("goods-list-list")?$(e).hasClass("switch-list")||($(".catalog_list .goods-list").removeClass("goods-list-list").addClass("goods-list-grid"),$(".catalog_list .goods-list-mode-switcher .switch-list").removeClass("active"),$(e).addClass("active"),applyAfterContentLoadHandlers(".catalog_list"),$.cookie("BARMAZ_goods_mode","",{expires:7,path:"/",domain:siteConfig.siteDomain,secure:siteConfig["siteSecure "]})):$(e).hasClass("switch-grid")||($(".catalog_list .goods-list").removeClass("goods-list-grid").addClass("goods-list-list"),$(".catalog_list .goods-list-mode-switcher .switch-grid").removeClass("active"),$(e).addClass("active"),$.cookie("BARMAZ_goods_mode","list",{expires:7,path:"/",domain:siteConfig.siteDomain,secure:siteConfig["siteSecure "]}))}function toggleParamElementDescripion(e){$(".modify-wrapper .params-select .prm_descr_elem").hide(),""!=$("#"+$(e).val()+"_descr_elem").html()&&$("#"+$(e).val()+"_descr_elem").show()}$(document).ready(function(){appendDTPicker($(".option_row .dateselector")),appendDTPicker($(".option_row .datetimeselector"),!0),appendDTPicker($(".option_row .timeselector"),!0,!1)});